@using Npgsql;
@using System.Dynamic;
@using System.Text.Json.Serialization;
@model List<MapItems>


@{
    Layout = "_Layout";
}
<head>
    @* <meta charset="utf-8"> *@
    @* <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> *@
    @* <meta name="description" content="Start your development with Ollie landing page."> *@
    @* <meta name="author" content="Devcrud"> *@
    @* <title>PoacherHunter2000</title> *@

    <!-- font icons -->
    <link rel="stylesheet" href="~/assets/vendors/themify-icons/css/themify-icons.css">
    <link rel="stylesheet" href="~/assets/vendors/fontawesome-free-6.2.1-web/css/fontawesome.css">
    <link rel="stylesheet" href="~/assets/vendors/fontawesome-free-6.2.1-web/css/solid.css">

    <!-- owl carousel -->
    @* <link rel="stylesheet" href="~/assets/vendors/owl-carousel/css/owl.carousel.css"> *@
    @* <link rel="stylesheet" href="~/assets/vendors/owl-carousel/css/owl.theme.default.css"> *@

    <!-- Bootstrap + Ollie main styles -->
    <link rel="stylesheet" href="~/assets/css/ollie.css">
    
    <!-- Map style + js -->
    <link rel="stylesheet" href="~/assets/vendors/leaflet/leaflet.css">
    <script src="~/assets/vendors/leaflet/leaflet.js"></script>
    <!--scripts for pdf -->
    
    <script  src="html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script> <script src="https://parall.ax/parallax/js/jspdf.js"></script>
    <script  src="Javascript/external/jspdf.plugin.standard_fonts_metrics.js"></script> <script  src="Javascript/external/jspdf.plugin.split_text_to_size.js"></script>  <script  src="Javascript/external/jspdf.plugin.from_html.js"></script> <script src="Javascript/external/jspdf.debug.js"></script>
    <script src="jspdf.min.js"></script> <script src="scriptD.js"></script> <script type="text/javascript" src="/js/myimage.js"></script>
    
    <!-- Extra's -->
    <link rel="stylesheet" href="~/assets/css/events.css">
    
    <!-- Background color, etc -->
    <link rel="stylesheet" href="~/assets/css/layoutsettings.css">

</head>
<body>
<div id="map">
    @* @await Html.PartialAsync("Map") *@
    <div class="container">
        <div class="row align-items-center mr-auto">
            <div class="col-md-4">
                <h3 class="section-title">Live Tracking</h3>
            </div>
            <div class="container">
                <div id="myLeafletMap" style="width:100%;height:400px;z-index: 0;"></div>
            </div>
        </div>
    </div>
</div>
@* $1$ <section class="section" id="about"> #1# *@
@*     <div class="container"> *@
@*         <div class="row align-items-center mr-auto"> *@
@*             <div class="col-md-4"> *@
@*                 <h3 class="section-title">Live Tracking</h3> *@
@*                 $1$ <a href="javascript:void(0)">Read more...</a> #1# *@
@*             </div> *@
@*             <div class="container"> *@
@*                 <div id="googleMap" style="width:100%;height:400px"></div> *@
@*             </div> *@
@*             <script> *@
@*              function myMap() { *@
@*              var mapProp= { *@
@*                  center:new google.maps.LatLng(51.508742,-0.120850), *@
@*                  zoom:5, *@
@*              }; *@
@*              var map = new google.maps.Map(document.getElementById("googleMap"),mapProp); *@
@*              } *@
@*          </script> *@
@*             <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIhCB6jZXgL-QVL-6oq4hWQzyX6xDcWeo&callback=myMap"></script> *@
@*         </div> *@
@*     </div> *@
@* $1$ </section> #1# *@
<section>
    <div id="events">
        @await Html.PartialAsync("Events")
    </div>
</section>
<div id="overlaybackgroundcolor" class="overlay-upperpart">
    <div id="overlaydetails" class="overlay">
        <div id="viewdetailsofevent" class="overlay-content">
            @* @Html.Partial("ViewDetailsPartial", Model[0]) *@
            @* close partial *@
        </div>
    </div>
</div>

<!-- core  -->
<script src="~/assets/vendors/jquery/jquery-3.4.1.js"></script>
@* <script src="~/assets/vendors/bootstrap/bootstrap.bundle.js"></script> *@
@* *@
@* <!-- bootstrap 3 affix --> *@
@* <script src="~/assets/vendors/bootstrap/bootstrap.affix.js"></script> *@

<script src="~/assets/js/events.js"></script>
<script src="~/assets/js/showEvents.js"></script>

<!-- Map script -->
<script>
 // function myMap() {
     
 var map = L.map('myLeafletMap').setView([-2.1188719515300574, 20.706445713722665], 6);
 L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
     maxZoom: 19,
     attribution: '&copy; <a href="http:www.openstreetmap.org/copyright">OpenStreetMap</a>'
 }).addTo(map);
 // }
 // myMap();
 addmarkers(@Json.Serialize(Model));
 function addmarkers(currentevents){
     // console.log("markeradd1: ");
     // console.log(currentevents);
     let markers = [];
     try {
     $(".leaflet-popup-pane").empty();
     $(".leaflet-marker-pane").empty();
     $(".leaflet-shadow-pane").empty();
     }
     catch (err){
     console.log("No layer found");    
     }
     finally {
     currentevents.forEach((element, i) =>
     markers[i] = new L.marker([element.latitude, element.longitude]).bindPopup(
         "Id: "+ element.id +"</br>Soundtype: "+ element.soundtype + "</br>Probability: " + element.probability));
     var test_showevents = L.layerGroup(markers);
     // console.log("markeradd2: ");
     // console.log(markers);
     test_showevents.addTo(map);
     // console.log("markeradd3: ");
     // console.log(test_showevents.getLayers());
     }
     
 }
 </script>
@* Function give model list *@
 @* // newmap(@Json.Serialize(Model)); *@


<script id="testing">
function loadNewEvents(){
    var i = 0;

    $('.col-icon').each(function(){
        i += 1;
    })
    console.log("current:" + i);
    if (i < 5){
        i += 1;
    }
            
    events(i)
    
    // Call ajax for data
    getmapdata(i)
}
</script>

<!-- Test codes, voor nu niet verwijderen - Min En -->
@* @{ var currentevents = Model.Count - 5;} *@
@* $('#events').load('@Url.Action("Map", "Home", new {addevent = currentevents})') *@

@* <script id="newtest"> *@
@* function changeFunction(currentevents){ *@
@*     var scripthtml = $(this).html(); *@
@*     $("testing").replaceWith('<script>'); *@
@*     } *@
@* </script> *@

<script type="text/javascript" id="reloadjs">
     setInterval("loadNewEvents()", 30000);
     </script>
<script>
function openNav(){
    document.getElementById('overlaybackgroundcolor').style.display = "block";
    document.getElementById('overlaydetails').style.display = "block";
}
function closeNav(){
    document.getElementById('overlaybackgroundcolor').style.display = "none";
    document.getElementById('overlaydetails').style.display = "none";
}
</script>
</body>
